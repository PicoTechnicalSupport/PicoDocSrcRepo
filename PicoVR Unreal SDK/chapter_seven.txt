.. _7 	Payment System:

7 	Payment System
============================

*Pico Pay* is a game currency payment system. It’s based on the Pico account system and is settled according to the current game currency unit (*P coin*) under Pico. You can use Pico Pay if your project needs an in-app purchase system. The following subsections describe Pico Pay in more detail.

7.1 	Preparing to Use Pico Pay
-----------------------------------------------

Use the following steps to integrate the payment SDK:

1.  Log in to the developer platform at `http://dev.picovr.com/ <http://dev.picovr.com/>`_  and register as a Pico member.

2.  Apply to be an *individual* or *enterprise developer*. Once your submission is reviewed, we’ll provide feedback within three working days. Please check on the status of your submission on the developer platform within this time frame.

3.  Check the merchant ID. After becoming a developer, click on the nickname in the upper right corner to view the developer ID, which will be your unique merchant ID for the payment system:

.. image:: _static/8.1.png

Figure 7.1 Checking the Merchant ID

4.  Obtain the corresponding strings.

5.  Developers can enter the application creation phase from the management center:

.. image:: _static/8.3a.png

Figure 7.2 Creating an Application.

6.  Click the button to create an application and select a platform to publish to:

.. image:: _static/8.4a.png

Figure 7.3 Selecting a platform to publish the app to.

7.  After entering the appropriate platform, you can add additional information including whether the app is free or paid and how much *P currency* to pay with.

8.  Complete the app-related information for the corresponding platform:

.. image:: _static/8.2.png

Figure 7.4 Entering the app-related information.

Enter the values for each field carefully because the app type cannot be modified once completed. If there exists an inside-props payment in your application, you must use the developer backend to add a merchandise code for unified management.

7.1.1   Description of Payments
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Pico currently has two types of payment methods: *P currency payment* (application type), and *commodity code payment* (game type). An application can only use one of the two payment methods.
After the app has been created successfully, the developer platform will assign it a number of strings including an ``APPID``, ``APP_KEY``, ``APP_Secret``, and a developer ID:

.. image:: _static/8.3.png

Figure 7.5 APP ID, APP KEY, APP Secret

Once these strings have been provided, select **In-Game Payment Settings** to configure in-game purchase information:

.. image:: _static/8.5a.png

Merchandise codes have the following attributes:

* The first character is a letter.
* Only letter and number symbols are allowed.
* The code can have up to 20 symbols.
* Codes for different props cannot be duplicated. 

If you support external payment of props for game applications, you must use add product codes in the background via unified management. Please select "In-game payment configuration" and configure the game's internal purchase information.

The props are categorized as *consumable* props and *inconsumable* props. Consumable props consist of merchandise that can be purchased repeatedly, such as gold coins, blood bottles, etc. Inconsumable props are one-time purchases such as weapons, checkpoint unlocks, etc.

7.1.2   Populating the Payment Strings in the PicoMobile Plugin for Unreal
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Navigate to **Edit** > **Project Settings…** > **PicoMobile**. Enable **Enable Payment Module** and then enable **Is Foreign** if you’re a foreign developer. Populate the **Merchant ID**, **App ID**, **App Key**, and **Pay Key**:

.. image:: _static/8.6a.png

Figure 7.6 - Populating the payment strings.

7.2 Payment System API Reference
-----------------------------------------------

Before you use the payment API, you must set up custom events using the **Pico Payment Set Callback Delegates** node provided:

.. image:: _static/8.7.png

Figure 7.7 - Pico Payment Set Callback Delegates node.

Figure 7.8 shows an example of defining a custom event for when the user logs in or out:

.. image:: _static/8.8.png

Figure 7.8 - Example of a custom event hooked up to a callback delegate in the Pico Payment Set Callback Delegates node.

The following subsections list the payment APIs and their respective callbacks.



7.2.1   Pico Payment Login
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

7.2.1.1 Function

Pico provides OAuth2.0 authentication and authorization, so users will need to log in before they can pay. This is implemented using the **Pico Payment Login** node provided in the SDK.
Users only need to log in once after which the payment can be used directly. Two weeks after the login, the function will return a code indicating the login has expired. Users will then need to log in again.

7.2.1.2 Callback

``On Pico Log in Out Callback``

Returns the following fields containing information about the login status:

+----------------+------------+--------------------------------------------------------------------------------------------------+ 
| Name           | Type       | Description                                                                                      | 
+================+============+==================================================================================================+ 
| ``isSuccuess`` | ``string`` | Set to ``true`` if the login was successful, or ``false`` if the login was not successful.       | 
+----------------+------------+--------------------------------------------------------------------------------------------------+ 
| ``reason``     | ``string`` | Information about the login status.                                                              | 
+----------------+------------+--------------------------------------------------------------------------------------------------+ 

7.2.2   Pico Payment Logout
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

7.2.2.1 Function

Logs the user out.

7.2.2.2 Callback

``On Pico Log in Out Callback``

Returns the following fields containing information about the logout status:

+----------------+------------+--------------------------------------------------------------------------------------------------+ 
| Name           | Type       | Description                                                                                      | 
+================+============+==================================================================================================+ 
| ``isSuccuess`` | ``string`` | Set to ``true`` if the logout was successful, or ``false`` if the logout was not successful.     | 
+----------------+------------+--------------------------------------------------------------------------------------------------+ 
| ``reason``     | ``string`` | Information about the logout status.                                                             | 
+----------------+------------+--------------------------------------------------------------------------------------------------+ 


7.2.3   Pico Payment Get User Info
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

7.2.3.1 Function

Returns information about the user.

7.2.3.2 Callback
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

``On Pico Get User Info Callback``

Returns the following fields containing information about the user:

+----------------+------------+--------------------------------------------------------------------------------------------------+ 
| Name           | Type       | Description                                                                                      | 
+================+============+==================================================================================================+ 
| ``ret_code``   | ``string`` | Specifies the result of the operation. If the value of this field is ``0000``, then ``data``     |
|                |            | contains information about the user. If the value of this field is ``5000``, then an error       |
|                |            | occurred and ``ret_msg`` contains a description of the error. See Return Codes below for a       |
|                |            | list of codes.                                                                                   |
+----------------+------------+--------------------------------------------------------------------------------------------------+ 
| ``data``       | Object     | Contains user information as described in the table below.                                       | 
+----------------+------------+--------------------------------------------------------------------------------------------------+ 
| ``ret_msg``    | ``string`` | Information about the login status.                                                              | 
+----------------+------------+--------------------------------------------------------------------------------------------------+ 

Sub fields of ``data`` when ``ret_code`` is set to ``0000``:

+----------------+------------+--------------------------------------------------------------------------------------------------+ 
| Name           | Type       | Description                                                                                      | 
+================+============+==================================================================================================+ 
| ``aboutme``    | ``string`` | A description of the user.                                                                       |
+----------------+------------+--------------------------------------------------------------------------------------------------+ 
| ``birthday``   | ``long``   | The user’s birthday.                                                                             |
+----------------+------------+--------------------------------------------------------------------------------------------------+ 
| ``phone``      | ``string`` | The user’s phone number.                                                                         |
+----------------+------------+--------------------------------------------------------------------------------------------------+ 
| ``username``   | ``string`` | The user’s username.                                                                             |
+----------------+------------+--------------------------------------------------------------------------------------------------+ 
| ``email``      | ``string`` | The user’s email address.                                                                        |
+----------------+------------+--------------------------------------------------------------------------------------------------+ 
| ``gender``     | ``string`` | The user’s gender.                                                                               |
+----------------+------------+--------------------------------------------------------------------------------------------------+ 
| ``lastname``   | ``string`` | The user’s last name.                                                                            |
+----------------+------------+--------------------------------------------------------------------------------------------------+ 
| ``openid``     | ``string`` | The user’s ID.                                                                                   |
+----------------+------------+--------------------------------------------------------------------------------------------------+ 
| ``firstname``  | ``string`` | The user’s first name.                                                                           |
+----------------+------------+--------------------------------------------------------------------------------------------------+ 
| ``avatar``     | ``string`` | A link to the user’s avatar image.                                                               |
+----------------+------------+--------------------------------------------------------------------------------------------------+ 
| ``name``       | ``string`` | The user’s name.                                                                                 |
+----------------+------------+--------------------------------------------------------------------------------------------------+ 
| ``country``    | ``string`` | The user’s country.                                                                              |
+----------------+------------+--------------------------------------------------------------------------------------------------+ 
| ``city``       | ``string`` | The user’s city.                                                                                 |
+----------------+------------+--------------------------------------------------------------------------------------------------+ 

**Return Codes**

+----------------+------------------------+--------------------------------------------------------------------------------------------------+ 
| Code           | Message                | Description                                                                                      | 
+================+========================+==================================================================================================+ 
| ``0000``       | 请求成功               | Request success.                                                                                 |
+----------------+------------------------+--------------------------------------------------------------------------------------------------+ 
| ``00020000``   | 数据库操作失败         | Database operation failed.                                                                       |
+----------------+------------------------+--------------------------------------------------------------------------------------------------+ 
| ``9999``       | 系统错误               | System error.                                                                                    |
+----------------+------------------------+--------------------------------------------------------------------------------------------------+ 
| ``00001000``   | 参数错误               | Parameter error.                                                                                 |
+----------------+------------------------+--------------------------------------------------------------------------------------------------+ 
| ``00002000``   | 数据解析失败           | Data parsing failed.                                                                             |
+----------------+------------------------+--------------------------------------------------------------------------------------------------+ 
| ``00003000``   | 签名验证失败           | Signature verification failed.                                                                   |
+----------------+------------------------+--------------------------------------------------------------------------------------------------+ 
| ``00003001``   | 时间验证失败           | Time validation failed.                                                                          |
+----------------+------------------------+--------------------------------------------------------------------------------------------------+ 
| ``00060000``   | 用户未找到             | User not found.                                                                                  |
+----------------+------------------------+--------------------------------------------------------------------------------------------------+ 
| ``00060001``   | 用户密码错误           | User password error.                                                                             |
+----------------+------------------------+--------------------------------------------------------------------------------------------------+ 
| ``00060002``   | 用户登录未知错误       | User logon unknown error.                                                                        |
+----------------+------------------------+--------------------------------------------------------------------------------------------------+ 
| ``00061000``   | 用户 token 未找到失败  | Cannot find user token.                                                                          |
+----------------+------------------------+--------------------------------------------------------------------------------------------------+ 
| ``00061001``   | 用户 token 验证失败    | User token validation failed.                                                                    |
+----------------+------------------------+--------------------------------------------------------------------------------------------------+ 
| ``00061002``   | 用户 token 未知错误    | User token unknown error.                                                                        |
+----------------+------------------------+--------------------------------------------------------------------------------------------------+ 
| ``00070001``   | 应用验证失败           | Application validation failed.                                                                   |
+----------------+------------------------+--------------------------------------------------------------------------------------------------+ 
| ``00071001``   | 应用密钥验证失败       | Application key authentication failed.                                                           |
+----------------+------------------------+--------------------------------------------------------------------------------------------------+ 
| ``00080001``   | OAUTH_CODE 验证失败    | OAUTH_CODE validation failed.                                                                    |
+----------------+------------------------+--------------------------------------------------------------------------------------------------+ 
| ``00090001``   | REFRESH_TOKEN 验证失败 | REFRESH_TOKEN validation failed.                                                                 |
+----------------+------------------------+--------------------------------------------------------------------------------------------------+ 
| ``00100001``   | ACCESS_TOKEN 验证失败  | ACCESS_TOKEN validation failed.                                                                  |
+----------------+------------------------+--------------------------------------------------------------------------------------------------+ 
| ``00110001``   | SCOPE 验证失败         | SCOPE validation failed.                                                                         |
+----------------+------------------------+--------------------------------------------------------------------------------------------------+ 

**Examples**

The following example shows information returned for a user:

.. code-block:: json

    { 
       "ret_code":"0000",
       "data":{ 
          "aboutme":"",
          "birthday":1460476800000,
          "phone":"13100000000",
          "username":"Admin",
          "email":"",
          "gender":"male",
          "lastname":"",
          "openid":"4f3148bdc34d9bca104927729a173b64",
          "firstname":"",
          "avatar":"http://172.31.83.11/upload/6dd6ee103714e967846c3d38ae48d511",
          "signature":"14a25d7219d8dfc91e55f63286ae5c0a",
          "country":"China",
          "city":""
       },
       "ret_msg":"调用成功"
    }

The following shows example the JSON that is returned if the system could not get information about the user:

.. code-block:: json

    { 
       "ret_code":"00003000",
       "ret_msg":"签名验证失败"
    }

7.2.4   Pico Payment Pay with Coin
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

7.2.4.1 Function

Makes a payment with P-coin. 

**Input**

Takes in a ``PicoCoinOrderInfo`` structure with the following fields:

+--------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 
| Name               | Type       | Description                                                                                                                   | 
+====================+============+===============================================================================================================================+ 
| ``Order Number``   | ``string`` | The order number generated by the merchant. Must be less than 32 characters and can contain letters and numbers only.         |
+--------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 
| ``Order Title``    | ``string`` | The title of the order.                                                                                                       | 
+--------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 
| ``Product Detail`` | ``string`` | A description of the product.                                                                                                 | 
+--------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 
| ``Notify Url``     | ``string`` | The URL to notify (not required).                                                                                             |
|                    |            | **Note**: The URL must be directly accessible and cannot contain parameters.                                                  |
+--------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 
| ``Pico Coin Count``| ``Integer``| The number of P-coins used for the payment.                                                                                   | 
+--------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 

7.2.4.2 Callback

``On Pico Pay Order Callback``

+----------------+------------+------------------------------------------------------------------------------------------------------------------+ 
| Name           | Type       | Description                                                                                                      | 
+================+============+==================================================================================================================+ 
| ``code``       | ``string`` | Specifies the result of the operation. If the value of this field is ``13000``, then ``msg`` contains            |
|                |            | information about the order. If the value of this field is another value, then an error occurred                 | 
|                |            | and ``msg`` contains a description of the error.                                                                 | 
+----------------+------------+------------------------------------------------------------------------------------------------------------------+ 
| ``msg``        | ``string`` | If ``code`` is ``13000``, this field contains information about the order as shown in the table below. If code   | 
|                |            | is another value, then this field provides a description of the error.                                           | 
+----------------+------------+------------------------------------------------------------------------------------------------------------------+ 

The following messages may be provided to the event handler:


+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| Code                             | Message                               | Description                                                                                      | 
+==================================+=======================================+==================================================================================================+ 
| ``00000``                        | 请求成功                              | Network anomaly.                                                                                 |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``10000``                        | 登录成功                              | Login successful.                                                                                |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``10001``                        | 用户未登陆                            | User not logged in.                                                                              |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``10002``                        | 请输入正确金额                        | Please enter the correct amount.                                                                 |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``10003``                        | 登陆过期，请重新登陆                  | Login expired, please re-login.                                                                  |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``11000``                        | 商户验证成功                          | Merchant verification successful.                                                                |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``11001``                        | 商户验证失败                          | Merchant authentication failed.                                                                  |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``11002``                        | 用户验证参数错误或请求过期            | User authentication parameter error or request expired.                                          |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``11003``                        | 商户未验证                            | Merchant not validated.                                                                          |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``12000``                        | 支付成功                              | Successful payment.                                                                              |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``12001``                        | 支付失败                              | Payment failure.                                                                                 |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``12003``                        | P 币不足                              | P coins are insufficient.                                                                        |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``12004``                        | 余额可用                              | Balance available.                                                                               |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``13000``                        | 生成订单                              | Generate order.                                                                                  |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``13001``                        | 获取数据失败                          | Failed to obtain data.                                                                           |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``13002``                        | 生成订单失败                          | Failed to generate order.                                                                        |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``14000``                        | 查询订单成功                          | Query for order success.                                                                         |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``14001``                        | 订单不存在/有误                       | The order does not exist / is incorrect.                                                         |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``14002``                        | 用户取消支付操作                      | User cancelled payment operation.                                                                |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``15000``                        | 未输入商品信息                        | No input commodity information.                                                                  |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``15001``                        | 未输入预付 ID                         | No prepaid ID entered.                                                                           |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``15002``                        | 请输入 Pico 支付订单号或商户订单号    | Enter Pico order number or merchant order number.                                                |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``NOAUTH``                       | 商户无此接口权限                      | Merchants do not have this interface authority.                                                  |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``SYSTEMERROR``                  | 系统错误                              | User cancelled payment operation.                                                                |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``APP_ID_NOT_EXIST``             | APP_ID 不存在                         | APP_ID does not exist.                                                                           |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``MCHID_NOT_EXIST``              | MCHID 不存在                          | MCHID does not exist.                                                                            |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``APP_ID_MCHID_NOT_MATCH``       | app_id 和 mch_id 不匹配               | app_id and mch_id not match.                                                                     |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``LACK_PARAMS``                  | 缺少参数                              | Parameter missing.                                                                               |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``SIGNERROR``                    | 签名错误                              | Signature error.                                                                                 |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``NO_DATA``                      | 没有查询到数据/用户未充值             | No query to data / user not prepaid.                                                             |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``ORDER_EXIST``                  | 订单已存在                            | The order already exists.                                                                        |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``PAY_CODE_NOT_EXIST``           | 消费代码不存在                        | The consumer code does not exist.                                                                |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``PAY_CODE_EXIST``               | 用户已对商品代码消费                  | The consumer has consumed the commodity code.                                                    |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 




7.2.5   Pico Payment Pay with Pay Code :sup:`1`
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

7.2.5.1 Function

Makes a payment with a pay code. 

**Input**

Takes in a ``PicoPayCodeOrderInfo`` structure with the following fields:


+--------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 
| Name               | Type       | Description                                                                                                                   | 
+====================+============+===============================================================================================================================+ 
| ``Order Number``   | ``string`` | The order number generated by the merchant. Must be less than 32 characters and can contain letters and numbers only.         |
+--------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 
| ``Order Title``    | ``string`` | The title of the order.                                                                                                       | 
+--------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 
| ``Product Detail`` | ``string`` | A description of the product.                                                                                                 | 
+--------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 
| ``Notify Url``     | ``string`` | The URL to notify (not required).                                                                                             |
|                    |            | **Note**: The URL must be directly accessible and cannot contain parameters.                                                  |
+--------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 
| ``Pico Pay Code``  | ``Integer``| The item code (see Section 7.1.1).                                                                                            | 
+--------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 


7.2.5.2 Callback

``On Pico Pay Order Callback``

Returns the following fields containing information about the order:

+----------------+------------+----------------------------------------------------------------------------------------------------------+ 
| Name           | Type       | Description                                                                                              | 
+================+============+==========================================================================================================+ 
| ``code``       | ``string`` | Specifies the result of the operation. If the value of this field is ``13000``, then ``msg`` contains    |
|                |            | information about the order. If the value of this field is another value, then an error occurred         | 
|                |            | and ``msg`` contains a description of the error.                                                         |
+----------------+------------+----------------------------------------------------------------------------------------------------------+ 
| ``msg``        | ``string`` | If ``code`` is ``13000``, this field contains information about the order as shown in the table below.   | 
|                |            | If ``code`` is another value, then this field provides a description of the error.                       |
+----------------+------------+----------------------------------------------------------------------------------------------------------+ 

The following messages may be provided to the event handler:

+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| Code                             | Message                               | Description                                                                                      | 
+==================================+=======================================+==================================================================================================+ 
| ``00000``                        | 请求成功                              | Network anomaly.                                                                                 |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``10000``                        | 登录成功                              | Login successful.                                                                                |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``10001``                        | 用户未登陆                            | User not logged in.                                                                              |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``10002``                        | 请输入正确金额                        | Please enter the correct amount.                                                                 |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``10003``                        | 登陆过期，请重新登陆                  | Login expired, please re-login.                                                                  |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``11000``                        | 商户验证成功                          | Merchant verification successful.                                                                |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``11001``                        | 商户验证失败                          | Merchant authentication failed.                                                                  |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``11002``                        | 用户验证参数错误或请求过期            | User authentication parameter error or request expired.                                          |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``11003``                        | 商户未验证                            | Merchant not validated.                                                                          |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``12000``                        | 支付成功                              | Successful payment.                                                                              |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``12001``                        | 支付失败                              | Payment failure.                                                                                 |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``12003``                        | P 币不足                              | P coins are insufficient.                                                                        |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``12004``                        | 余额可用                              | Balance available.                                                                               |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``13000``                        | 生成订单                              | Generate order.                                                                                  |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``13001``                        | 获取数据失败                          | Failed to obtain data.                                                                           |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``13002``                        | 生成订单失败                          | Failed to generate order.                                                                        |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``14000``                        | 查询订单成功                          | Query for order success.                                                                         |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``14001``                        | 订单不存在/有误                       | The order does not exist / is incorrect.                                                         |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``14002``                        | 用户取消支付操作                      | User cancelled payment operation.                                                                |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``15000``                        | 未输入商品信息                        | No input commodity information.                                                                  |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``15001``                        | 未输入预付 ID                         | No prepaid ID entered.                                                                           |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``15002``                        | 请输入 Pico 支付订单号或商户订单号    | Enter Pico order number or merchant order number.                                                |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``NOAUTH``                       | 商户无此接口权限                      | Merchants do not have this interface authority.                                                  |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``SYSTEMERROR``                  | 系统错误                              | User cancelled payment operation.                                                                |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``APP_ID_NOT_EXIST``             | APP_ID 不存在                         | APP_ID does not exist.                                                                           |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``MCHID_NOT_EXIST``              | MCHID 不存在                          | MCHID does not exist.                                                                            |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``APP_ID_MCHID_NOT_MATCH``       | app_id 和 mch_id 不匹配               | app_id and mch_id not match.                                                                     |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``LACK_PARAMS``                  | 缺少参数                              | Parameter missing.                                                                               |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``SIGNERROR``                    | 签名错误                              | Signature error.                                                                                 |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``NO_DATA``                      | 没有查询到数据/用户未充值             | No query to data / user not prepaid.                                                             |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``ORDER_EXIST``                  | 订单已存在                            | The order already exists.                                                                        |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``PAY_CODE_NOT_EXIST``           | 消费代码不存在                        | The consumer code does not exist.                                                                |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``PAY_CODE_EXIST``               | 用户已对商品代码消费                  | The consumer has consumed the commodity code.                                                    |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 


7.2.6   Pico Payment Query Order
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
7.2.6.1 Function

Provides information about an existing payment order.

+------------------+------------+--------------------------------------------------------------------------------------------------------------------------------+ 
| Name             | Type       | Description                                                                                                                    | 
+==================+============+================================================================================================================================+ 
| ``Order Number`` | ``string`` | The order number generated by the merchant. Must be less than 32 characters and can contain letters and numbers only.          |
+------------------+------------+--------------------------------------------------------------------------------------------------------------------------------+ 

7.2.6.2	Callbacks

``On Pico Query Order Callback``

Returns the following fields containing information about the order:


+----------------+------------+------------------------------------------------------------------------------------------------------------------+ 
| Name           | Type       | Description                                                                                                      | 
+================+============+==================================================================================================================+ 
| ``code``       | ``string`` | Specifies the result of the operation. If the value of this field is ``13000``, then ``msg`` contains            |
|                |            | information about the order. If the value of this field is another value, then an error occurred                 | 
|                |            | and ``msg`` contains a description of the error.                                                                 | 
+----------------+------------+------------------------------------------------------------------------------------------------------------------+ 
| ``msg``        | ``string`` | If ``code`` is ``13000``, this field contains information about the order as shown in the table below. If        | 
|                |            | ``code`` is another value, then this field provides a description of the error.                                  | 
+----------------+------------+------------------------------------------------------------------------------------------------------------------+ 

Sub-fields of ``msg`` when code is set to ``13000``:

+--------------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 
| Name                     | Type       | Description                                                                                                                   | 
+==========================+============+===============================================================================================================================+ 
| ``trade_no``             | ``string`` | The Pico Pay order number.                                                                                                    |
+--------------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 
| ``open_id``              | ``string`` | The user ID.                                                                                                                  |
+--------------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 
| ``ret_msg``              | ``string`` | A message related to the payment.                                                                                             |
+--------------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 
| ``coupon_fee``           | ``float``  | The coupon fee.                                                                                                               |
+--------------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 
| ``fee_type``             | ``string`` | The fee type.                                                                                                                 |
+--------------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 
| ``pay_time``             | ``long``   | The time that the payment completed.                                                                                          |
+--------------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 
| ``nonce_str``            | ``string`` | A nonce.                                                                                                                      |
+--------------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 
| ``out_trade_noo``        | ``string`` |                                                                                                                               |
+--------------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 
| ``trade_status``         | ``string`` | Will be set to ``SUCCESS`` if the payment succeeded.                                                                          |
+--------------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 
| ``result_code``          | ``string`` |                                                                                                                               |
+--------------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 
| ``mch_id``               | ``string`` | The company ID.                                                                                                               |
+--------------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 
| ``ret_code``             | ``string`` | A return code.                                                                                                                |
+--------------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 
| ``sub_msg``              | ``string`` |                                                                                                                               |
+--------------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 
| ``total_fee``            | ``float``  | The total amount of the order.                                                                                                |
+--------------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 
| ``app_id``               | ``string`` | The application’s ID.                                                                                                         |
+--------------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 
| ``sub_code``             | ``string`` |                                                                                                                               |
+--------------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 
| ``receipt_fee``          | ``string`` |  The fee received.                                                                                                            |
+--------------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 
| ``buyer_pay_fee``        | ``string`` |   The fee that the buyer paid.                                                                                                |
+--------------------------+------------+-------------------------------------------------------------------------------------------------------------------------------+ 

The following messages may be provided to the event handler:

+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| Code                             | Message                               | Description                                                                                      | 
+==================================+=======================================+==================================================================================================+ 
| ``00000``                        | 请求成功                              | Network anomaly.                                                                                 |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``10000``                        | 登录成功                              | Login successful.                                                                                |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``10001``                        | 用户未登陆                            | User not logged in.                                                                              |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``10002``                        | 请输入正确金额                        | Please enter the correct amount.                                                                 |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``10003``                        | 登陆过期，请重新登陆                  | Login expired, please re-login.                                                                  |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``11000``                        | 商户验证成功                          | Merchant verification successful.                                                                |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``11001``                        | 商户验证失败                          | Merchant authentication failed.                                                                  |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``11002``                        | 用户验证参数错误或请求过期            | User authentication parameter error or request expired.                                          |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``11003``                        | 商户未验证                            | Merchant not validated.                                                                          |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``12000``                        | 支付成功                              | Successful payment.                                                                              |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``12001``                        | 支付失败                              | Payment failure.                                                                                 |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``12003``                        | P 币不足                              | P coins are insufficient.                                                                        |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``12004``                        | 余额可用                              | Balance available.                                                                               |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``13000``                        | 生成订单                              | Generate order.                                                                                  |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``13001``                        | 获取数据失败                          | Failed to obtain data.                                                                           |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``13002``                        | 生成订单失败                          | Failed to generate order.                                                                        |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``14000``                        | 查询订单成功                          | Query for order success.                                                                         |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``14001``                        | 订单不存在/有误                       | The order does not exist / is incorrect.                                                         |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``14002``                        | 用户取消支付操作                      | User cancelled payment operation.                                                                |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``15000``                        | 未输入商品信息                        | No input commodity information.                                                                  |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``15001``                        | 未输入预付 ID                         | No prepaid ID entered.                                                                           |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``15002``                        | 请输入 Pico 支付订单号或商户订单号    | Enter Pico order number or merchant order number.                                                |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``NOAUTH``                       | 商户无此接口权限                      | Merchants do not have this interface authority.                                                  |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``SYSTEMERROR``                  | 系统错误                              | User cancelled payment operation.                                                                |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``APP_ID_NOT_EXIST``             | APP_ID 不存在                         | APP_ID does not exist.                                                                           |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``MCHID_NOT_EXIST``              | MCHID 不存在                          | MCHID does not exist.                                                                            |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``APP_ID_MCHID_NOT_MATCH``       | app_id 和 mch_id 不匹配               | app_id and mch_id not match.                                                                     |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``LACK_PARAMS``                  | 缺少参数                              | Parameter missing.                                                                               |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``SIGNERROR``                    | 签名错误                              | Signature error.                                                                                 |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``NO_DATA``                      | 没有查询到数据/用户未充值             | No query to data / user not prepaid.                                                             |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``ORDER_EXIST``                  | 订单已存在                            | The order already exists.                                                                        |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``PAY_CODE_NOT_EXIST``           | 消费代码不存在                        | The consumer code does not exist.                                                                |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 
| ``PAY_CODE_EXIST``               | 用户已对商品代码消费                  | The consumer has consumed the commodity code.                                                    |
+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------------------+ 

``On Pico Payment Exception Callback``

Returns the following fields containing information about an exception that occurred during a payment:

+----------------+------------+------------------------------------------------------------------------------------------------------------------+ 
| Name           | Type       | Description                                                                                                      | 
+================+============+==================================================================================================================+ 
| ``code``       | ``string`` | Specifies a code related to the exception.                                                                       | 
+----------------+------------+------------------------------------------------------------------------------------------------------------------+ 
| ``msg``        | ``string`` | Information about the exception.                                                                                 | 
+----------------+------------+------------------------------------------------------------------------------------------------------------------+ 

For a list of codes and messages see Section 7.2.4.2.

7.3    Developer Server Interactions
-----------------------------------------------

When payment completes, the pay system will send the corresponding pay result and user information to the merchant. The merchant then needs to process the data received and return a response.
If the response the payment system receives from the merchant does not indicate success or a timeout, the payment system will treat the response as a failure and the payment system will periodically resend notifications in an attempt to get a response that indicates success.

The same notification may be sent to the merchant system many times and the merchant system must be able to process repeated notifications correctly. When receiving a notification for processing, check the status of the corresponding business data to determine if a notification has been processed already. Process it if it hasn’t and return a success response. Before checking and processing business data, use a data lock for concurrency control caused by function reentry.

The merchant’s server must implement the following interface to receive the requests from the Pico server and to get payment results and user information from the Pico payment system.

**Request**

``POST /Pay``

**Body Parameters**

+-----------------------+------------+-------------------------------------------------------------------------------------------------------------------------------------+ 
| Name                  | Type       | Required  | Description                                                                                                             | 
+=======================+============+===========+=========================================================================================================================+ 
| ``ret_code``          | ``string`` | Yes       | A notification identification.                                                                                          | 
|                       |            |           | **Note**: This is not a trade identification. The ``result_code`` is used to determine whether a trade was successful.  |
+-----------------------+------------+-----------+-------------------------------------------------------------------------------------------------------------------------+ 
| ``ret_msg``           | ``string`` | No        | Indicates the reason for an error.                                                                                      | 
+-----------------------+------------+-----------+-------------------------------------------------------------------------------------------------------------------------+ 
| ``sub_code``          | ``string`` | No        | An error code.                                                                                                          | 
+-----------------------+------------+-----------+-------------------------------------------------------------------------------------------------------------------------+ 
| ``sub_msg``           | ``string`` | No        | A description of the error.                                                                                             | 
+-----------------------+------------+-----------+-------------------------------------------------------------------------------------------------------------------------+ 
| ``trade_no``          | ``string`` | Yes       | Pico payment order number.                                                                                              | 
+-----------------------+------------+-----------+-------------------------------------------------------------------------------------------------------------------------+ 
| ``out_trade_no``      | ``string`` | Yes       | The internal order number from the merchant system.                                                                     | 
+-----------------------+------------+-----------+-------------------------------------------------------------------------------------------------------------------------+ 
| ``app_id``            | ``string`` | Yes       | The ``APP_ID`` that the platform has audited.                                                                           | 
+-----------------------+------------+-----------+-------------------------------------------------------------------------------------------------------------------------+ 
| ``mch_id``            | ``string`` | Yes       | The merchant ID that has been assigned to the payment.                                                                  | 
+-----------------------+------------+-----------+-------------------------------------------------------------------------------------------------------------------------+ 
| ``open_id``           | ``string`` | Yes       | The unique ID of the user under the merchant’s appID.                                                                   | 
+-----------------------+------------+-----------+-------------------------------------------------------------------------------------------------------------------------+ 
| ``device_id``         | ``string`` | No        | The ID of the terminal device.                                                                                          | 
+-----------------------+------------+-----------+-------------------------------------------------------------------------------------------------------------------------+ 
| ``nonce_str``         | ``string`` | Yes       | A random string, less than 32 characters in length. Use of a random number generation algorithm is recommended to       |
|                       |            |           | generate this value.                                                                                                    | 
+-----------------------+------------+-----------+-------------------------------------------------------------------------------------------------------------------------+ 
| ``Name``              | ``string`` | Yes       | See details in the name generation algorithm described in Section 7.3.1.                                                | 
+-----------------------+------------+-----------+-------------------------------------------------------------------------------------------------------------------------+ 
| ``result_code``       | ``string`` | Yes       | The result of the operation. Can be set to ``SUCCESS`` or ``FAIL``.                                                     | 
+-----------------------+------------+-----------+-------------------------------------------------------------------------------------------------------------------------+ 
| ``trade_type``        | ``string`` | Yes       | The payment type.                                                                                                       | 
+-----------------------+------------+-----------+-------------------------------------------------------------------------------------------------------------------------+ 
| ``fee_type``          | ``string`` | Yes       | The currency type.                                                                                                      | 
+-----------------------+------------+-----------+-------------------------------------------------------------------------------------------------------------------------+ 
| ``total_fee``         | ``string`` | Yes       | The total amount for the order.                                                                                         | 
+-----------------------+------------+-----------+-------------------------------------------------------------------------------------------------------------------------+ 
| ``receipt_fee``       | ``string`` | Yes       | The actual fee.                                                                                                         | 
+-----------------------+------------+-----------+-------------------------------------------------------------------------------------------------------------------------+ 
| ``total_fee``         | ``string`` | Yes       | The total amount for the order.                                                                                         | 
+-----------------------+------------+-----------+-------------------------------------------------------------------------------------------------------------------------+ 
| ``buyer_pay_fee``     | ``string`` | No        | The amount of the fee that the buyer paid.                                                                              | 
+-----------------------+------------+-----------+-------------------------------------------------------------------------------------------------------------------------+ 
| ``coupon_fee``        | ``string`` | No        | The voucher or discount amount.                                                                                         | 
+-----------------------+------------+-----------+-------------------------------------------------------------------------------------------------------------------------+ 
| ``attach``            | ``string`` | No        | Merchant packets, returning as-is.                                                                                      | 
+-----------------------+------------+-----------+-------------------------------------------------------------------------------------------------------------------------+ 
| ``pay_time``          | ``string`` | Yes       | The time when the payment completed, in the form of “yyyy-MM-dd  HH:mm:ss”.                                             | 
+-----------------------+------------+-----------+-------------------------------------------------------------------------------------------------------------------------+ 
| ``signature``         | ``string`` | Yes       | See the signature generation algorithm.                                                                                 | 
+-----------------------+------------+-----------+-------------------------------------------------------------------------------------------------------------------------+ 

**Response Fields**


+----------------+------------+--------------------------------------------------------------------------------------------------+ 
| Name           | Type       | Description                                                                                      | 
+================+============+==================================================================================================+ 
| ``ret_code``   | ``string`` | Will be set to ``SUCCESS`` if the merchant has successfully received the notification and has    |
|                |            | validated, or ``FAIL`` if the operation failed.                                                  |
+----------------+------------+--------------------------------------------------------------------------------------------------+ 
| ``ret_msg``    | ``string`` | The return message. If populated, the message contains the reason for the error (e.g. “name      |
|                |            | failed - parameter format validation error”).                                                    | 
+----------------+------------+--------------------------------------------------------------------------------------------------+ 

**Note**: The merchant system must validate the Name field in the payment result notification contents, in order to avoid a loss of funds caused by a “fake notification” due to a data leakage.

To validate the name:

1.  Remove the Name parameter from the list of parameters returned.
2.  Add ``“key = “app_secret”, value=paykey”``.
3.  Perform a natural sort according to the value of “key”.
4.  Use & to separate multiple parameters.
5.  Encrypt the value using MD5 encryption.
6.  Compare the encrypted string with the name you obtained. 

The following shows an example validation function:

.. code-block:: java

    /** 
    * result: the map collection of retrieved data  
    * paykey: It’s the paykey on the developer platform 
    */ 
    public static String createSign(Map<String, Object> result, String paykey) 
    { 
        if (result == null || result.size() == 0) 
            return null; 
        result.put("app_secret", paykey); //1.Add key = “app_secret”, value=payke  
        String sign = result.get("Name");//2.Save Name value, to be used for validation  
        result.remove("Name"); //3.remove Name parameter  
        String[] tmp = new String[result.size()]; 
        int i = 0; 
        for (String key : result.keySet()) 
        { 
            tmp[i++] = key; 
        } 
        Arrays.sort(tmp); //4.natural sort 
        String signTemp = ""; 
        for (String string : tmp) 
        { 
            if (result.get(string) == null) 
                continue; 
            signTemp += string + "=" + URLEncoder.encode(result.get(string).toString() 
                , "utf-8") + "&"; 
        } 
        if (signTemp.endsWith("&")) 
            signTemp = sign.substring(0, signTemp .length() - 1); 
        Log.i(TAG, "createSign: " + signTemp ); 
        String localSign = MD5.MD5(sign); //5.generate MD5 encrypted string  
        return localSign.equal(sign);//6.validate with “sign” in 2  

    }


:sup:`1` Commodity code payment is a new payment system designed for the developer platform. Developers must create different products for their game on the developer platform, and fill in the commodity code. During development, developers do not have to fill in the amount of the goods. Instead developers must fill in the corresponding commodity code and invoke the payment interface to make payments.
